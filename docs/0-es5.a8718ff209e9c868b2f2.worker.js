function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,(function(t){return e[t]}).bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="6srL")}({"6srL":function(e,t,n){"use strict";n.r(t);var r=function(){function e(t,n,r){_classCallCheck(this,e),this.flagged=!1,this.mine=!1,this.x=t,this.y=n,this.value=r}return _createClass(e,[{key:"hasProbability",value:function(){return void 0!==this.probability}},{key:"isClosed",value:function(){return Number.isNaN(this.value)}},{key:"isFlagged",value:function(){return this.flagged}},{key:"isOpened",value:function(){return!this.isClosed()}},{key:"isMined",value:function(){return this.mine}},{key:"isUnknown",value:function(){return this.isClosed()&&!this.isMined()}},{key:"setFlag",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.flagged=e,this}},{key:"setMine",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.mine=e,this}}]),e}(),i=function(){function e(t,n){_classCallCheck(this,e),this._mines=t,this._fields=n}return _createClass(e,[{key:"probabilities",get:function(){return this.fields.filter((function(e){return e.hasProbability()})).map((function(e){return e.probability})).reduce((function(e,t){return e+t}))}},{key:"probabilityMin",get:function(){var e=this.fields.map((function(e){return e.probability})).filter((function(e,t,n){return void 0!==e&&n.indexOf(e)===t}));return Math.min.apply(Math,_toConsumableArray(e))}},{key:"randomFieldMin",get:function(){var e=this.probabilityMin,t=this.fields.filter((function(t){return t.probability<=e}));return t[function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"randomInteger",value:function(e,t){return Math.floor(Math.random()*(t-e+1))+e}}]),e}().randomInteger(0,t.length-1)]}},{key:"fields",get:function(){return this._fields}},{key:"mines",get:function(){return this._mines}},{key:"size",get:function(){return this.fields.length}}]),e}(),a=function(){function e(t){_classCallCheck(this,e),this.fields=[],this.init(t)}return _createClass(e,[{key:"field",value:function(e,t){return this.fields.find((function(n){return n.x===e&&n.y===t}))}},{key:"fieldNeighbors",value:function(e){var t=this,n=[],r=[e.y-1,e.y,e.y+1].filter((function(e){return e>=0}));return[e.x-1,e.x,e.x+1].filter((function(e){return e>=0})).forEach((function(e){r.forEach((function(r){return n.push(t.field(e,r))}))})),n.filter((function(e){return!!e}))}},{key:"fieldsValuable",value:function(){return this.fields.filter((function(e){return e.isOpened()&&e.value>0}))}},{key:"fieldsMined",value:function(){return this.fields.filter((function(e){return e.isMined()}))}},{key:"init",value:function(e){var t=this;e&&(this._data=e,e.forEach((function(e,n){e.forEach((function(e,i){var a=new r(i,n,+e);"*"===e&&a.setMine(),t.fields.push(a)}))})))}},{key:"hasFields",value:function(){return this.fields.length>0}},{key:"lastX",value:function(){return this.hasFields()&&this.fields[this.fields.length-1].x}},{key:"lastY",value:function(){return this.hasFields()&&this.fields[this.fields.length-1].y}},{key:"data",get:function(){var e=this._data;return this.fieldsMined().forEach((function(t){var n=t.x,r=t.y;return e[r][n]="*"})),this._data}},{key:"height",get:function(){return this.hasFields()?this.lastY()+1:0}},{key:"size",get:function(){return this.height*this.width}},{key:"width",get:function(){return this.hasFields()?this.lastX()+1:0}}]),e}(),o=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"calculate",value:function(t){var n=e.initGroups(t);return n.forEach((function(e){e.fields.forEach((function(t){t.probability=t.hasProbability()?1-(1-t.probability)*(1-e.mines/e.size):e.mines/e.size}))})),e.correct(n)}},{key:"correct",value:function(e){var t;do{t=!1,e.forEach((function(e){var n=100*e.probabilities,r=100*e.mines;if(Math.abs(n-r)>1){t=!0;var i=r/n;e.fields.forEach((function(e){return e.probability*=i}))}}))}while(t);return e.forEach((function(e){e.fields.forEach((function(e){e.probability=e.probability>.99?.99:e.probability,e.probability=e.probability<0?0:e.probability}))})),e}},{key:"initGroups",value:function(e){var t=[];return e.fieldsValuable().forEach((function(n){var r=e.fieldNeighbors(n),a=r.filter((function(e){return e&&e.isUnknown()}));if(a.length>0){var o=r.filter((function(e){return e&&e.isMined()})).length;t.push(new i(n.value-o,a))}})),t}}]),e}();addEventListener("message",(function(e){var t=e.data,n=new a(t),r=u(n);postMessage(r)}));var u=function(e){var t=o.calculate(e),n=new Set;return t.forEach((function(e){e.fields.forEach((function(e){e.probability>=.9?(e.setMine(!0),n.add(e)):0===e.probability&&n.add(e)}));var t=e.probabilityMin;t>0&&t<=.05&&n.add(e.randomFieldMin)})),Array.from(n)}}});